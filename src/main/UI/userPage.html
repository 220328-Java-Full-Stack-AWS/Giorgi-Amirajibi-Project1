<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>USER PAGE</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript">
        (function logInCheck() {
            if (sessionStorage.getItem('status') == null)
            {
                window.location.href = "login.html"
            }
        })();
    </script>
</head>
<body>
    <input type="button" value="Create Reimbursement" onclick="reimb()">
    <input type="button" value="View Reimbursement" onclick="viewReimb()">
    <input type="button" value="Edit Reimbursement">
    <br>
    <p id="reimbursement"></p>
    <script>
        async function viewReimb(){
            document.getElementById("reimbursement").innerHTML =
                "<table>" +
                "<tr>" +
                "    <th>Description</th>" +
                "    <th>Amount</th>" +
                "    <th>Type</th>" +
                "    <th>Status</th>" +
                "    <th>Submitted</th>" +
                "</tr>" +
                "    <tbody id='content'></tbody>"
                "</table>";

            let username = sessionStorage.getItem("username");
            let response = await fetch(
                "../reimbursement",
                {
                    method: "GET",
                    headers:
                        {
                            "Content-Type" : "application/json",
                            "username" : username
                        }
                }
            );

            let json = JSON.parse(response.headers.get("json"));
            for (let i = 0; i < json.length; i++) {
                let tableRow = '<tr id="' + json[i].reimbId + '">' + "<td>" + json[i].reimbDescription + "</td>" +
                    "<td>" + json[i].reimbAmount + "$" + "</td>" + "<td>" + json[i].reimbType + "</td>" +
                    "<td>" + json[i].reimbStatus + "</td>" + "<td>" + json[i].reimbSubmitted.slice(0,19) +
                    "</td>" + "<td>" + "<input type='button' id='" + json[i].reimbId + "' name='delete' value='Delete' onclick='reimbDelete(this.id)'>" + "</td>" + "</tr>";
                document.getElementById("content").innerHTML += tableRow;
            }


        }

    </script>
    <script>
        async function reimbDelete(i){

            let response = await fetch(
                "../reimbursement",
                {
                    method: "DELETE",
                    headers:
                        {
                            "Content-Type": "application/json",
                            "json" : i
                        }
                }
            );
            if (response.headers.get("status") == "success"){
                viewReimb();
            }
        }
    </script>

    <script>
        function reimb(){

            document.getElementById("reimbursement").innerHTML= "<label for='reimbType'>Reimbursement Type</label>\n" +
                "\n" +
                "<select name='reimbType' id='reimbType'>\n" +
                "  <option value='LODGING'>Lodging</option>\n" +
                "  <option value='FOOD'>Food</option>\n" +
                "  <option value='TRAVEL'>Travel</option>\n" +
                "</select><br>" +
                "<input type='text' id='reimbAmount' placeholder='Reimbursement Amount'><br>" +
                "<input type='text' id='reimbDescription' placeholder='Reimbursement Description'><br>" +
                "<input type='submit' id='submit' type='submit' onclick='createReimb()'>";
        }
    </script>
    <script>
        async function createReimb(){
            let data = new Object();
            data.username = sessionStorage.getItem('username');
            data.reimbType = document.getElementById("reimbType").value;
            data.reimbAmount = document.getElementById("reimbAmount").value;
            data.reimbDescription = document.getElementById("reimbDescription").value;
            data.reimbSubmitted = new Date().toISOString().slice(0, 19).replace('T', ' ');
            let json = JSON.stringify(data);

            let response = await fetch(
                "../reimbursement",
                {
                    method : "POST",
                    headers :
                    {
                        "Content-Type": "application/json",
                    },
                    body : json
                }

            );
            console.log(response);
            location.reload();

        }
    </script>
</body>
</html>